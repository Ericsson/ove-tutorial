#!/usr/bin/env bash

if command -v incus > /dev/null; then
	_cmd="incus"
elif command -v lxc > /dev/null; then
	_cmd="lxc"
else
	echo "error: command incus/lxc not found" 1>&2
	exit 1
fi

export OVE_DISTROCHECK_STEPS="user ssh"
echo "set -x;date;whoami;cat /etc/os-release;hostname;ip addr" > "${OVE_TMP:?}/a"
if [ -n "${TMUX}" ]; then
	__s="-parallel"
fi
ove-distrocheck${__s} \
	"${OVE_TMP}/a" \
	alpine/edge$ \
	ubuntu/24.04$
unset __s

if [ -n "${TMUX}" ]; then
	watch -d -t -x -- bash -c "${_cmd:?} list --format compact"
fi
